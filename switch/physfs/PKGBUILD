# Maintainer: COMP Omega <compomega@tutanota.com>
pkgname=switch-physfs
pkgver=3.0.2
pkgrel=2
pkgdesc='scene-oriented, flexible 3D engine written in C++'
arch=('any')
url='https://icculus.org/physfs/'
license=('zlib')
options=(!strip libtool staticlibs)
source=( "https://icculus.org/physfs/downloads/physfs-${pkgver}.tar.bz2" "physfs-switch.patch")
makedepends=('devkitA64' 'devkitpro-pkgbuild-helpers')
depends=()
sha256sums=(
  '304df76206d633df5360e738b138c94e82ccf086e50ba84f456d3f8432f9f863'
  'fed3054d109d1949e85a7ecfdfcb6a02989f769cb6dce0251db2df1de31747f1')
groups=('switch-portlibs')
build() {
  cd physfs-$pkgver

  source /opt/devkitpro/switchvars.sh

  # from: https://github.com/carstene1ns/physfs-switch
  patch -Np0 -i "$srcdir"/physfs-switch.patch

  cmake -G"Unix Makefiles" \
    -DCMAKE_TOOLCHAIN_FILE=/opt/devkitpro/switch.cmake \
    -DCMAKE_C_FLAGS="$CFLAGS $CPPFLAGS" \
    -DCMAKE_CXX_FLAGS="$CXXFLAGS $CPPFLAGS" \
    -DCMAKE_INSTALL_PREFIX=$PORTLIBS_PREFIX \
    -DPHYSFS_BUILD_STATIC=ON -DPHYSFS_BUILD_SHARED=OFF \
    -DPHYSFS_BUILD_TEST=OFF \
    .

  make

}

package() {

  cd physfs-$pkgver

  source /opt/devkitpro/switchvars.sh

  make install DESTDIR="$pkgdir"

}
